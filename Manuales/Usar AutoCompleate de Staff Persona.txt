
Manual para usar Autocompleaate de Staff Persona
		- Ale Camargo

En el modelo que esta vinculado a staff-persona, agregar :
    En las librerias:
    use app\models\rrhh\StaffPersona;

    Antes de las reglas[rules]:
    	public $autocomplete_staff_persona;

    y en las reglas agregar:
        [['autocomplete_staff_persona'],'string'],

En la vista-form:

	includes requeridos:

	use kartik\typeahead\Typeahead;
	use yii\helpers\Url;

	// El campo 'variableTemporal', debe ser una variable que no guarde directametne el id. Similar a las variables $password_rep, que sirven para capturar datos, pero que no se guardan

	<?= $form->field($model, 'autocomplete_staff_persona')->widget(Typeahead::classname(), [
                'options' => ['placeholder' => 'Buscar ... '],
                'pluginOptions' => ['highlight'=>true],
                'dataset' => [
                    [
                        'datumTokenizer' => "Bloodhound.tokenizers.obj.whitespace('nombre_completo')",
                        'display' => 'nombre_completo',
                        'remote' => [
                            'url' => Url::base().'/rrhh/staff-persona/autocompletar-nombre-completo'. '?q=%QUERY',
                            'wildcard' => '%QUERY'
                        ]

                    ]
                ]
            ])->label('Personal Asignado');
        ?>

        /// ])->label('Personal Asignado'); se puede cambiar el texto mostrado editando el campo de label o eliminarlo y sobre escribir la función attributeLabels en el modelo. agregando, por ejemplo 'autocomplete_staff_persona' => Yii::t('app', 'Persona Autorizada'),
        


En el Modelo de la entidad que estamos editando, en BeforeSave (segun corresponda)
	¡¡ remplazar "responsable", por el campo al cual asignaremos el id !!
		
            if (isset($this->autocomplete_staff_persona)) {
                $this->responsable = StaffPersona::getIdByDniNombre($this->autocomplete_staff_persona);
            }

    o copiar este beforeSave:

    public function beforeSave($insert){
        if (parent::beforeSave($insert)) {
             if(Yii::$app->user->isGuest)
                return false;
             
            $this->actualizado_por= Yii::$app->user->identity->usuario_id;

            if (isset($this->autocomplete_staff_persona)) {
                $this->responsable = StaffPersona::getIdByDniNombre($this->autocomplete_staff_persona);
            }
            
             
            $this->actualizado_en = date('Y-m-d H:i:s');
            if ($this->isNewRecord) {
                $this->creado_por = Yii::$app->user->identity->usuario_id;
                $this->creado_en = date('Y-m-d H:i:s');
            }
            return true;
        }
        return false;
    }

Finalmente agregar en el controlador - Update:
Agregar la libreria:
    use app\models\rrhh\StaffPersona;
En la función update (remplazando los campos correspondientes: autocompleate_staff_persona, y responsable):
	$model->autocomplete_staff_persona = StaffPersona::getDniNombreById($model->responsable);

OBSERVACION: 
En las reglas de modelo, si el campo correspondiente al id persona era obligatorio se le debe REMPLAZAR en las reglas por el nuevo campo autocomplete_staff_persona


